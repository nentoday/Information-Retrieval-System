<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Search</title>
</head>
<body>
    <h1>Search</h1>
    <input type="text" id="searchInput" placeholder="Type your search here...">
    <button onclick="search()">Find</button>

    <ul id="results"></ul>

<script>
    let rawResults = [];

    function search() {
        const keyword = document.getElementById("searchInput").value;
        fetch(`/search?q=${encodeURIComponent(keyword)}`)
            .then(response => response.json())
            .then(data => {
                rawResults = data;
                showTitles(data);
            })
            .catch(error => console.error("Search error:", error));
    }

    function showTitles(data) {
        const resultsList = document.getElementById("results");
        resultsList.innerHTML = "";

        data.forEach((row, index) => {
            const li = document.createElement("li");

            const titleEl = document.createElement("div");
            titleEl.innerHTML = `<strong style="cursor:pointer; color:blue">${row.title}</strong>`;
            titleEl.addEventListener("click", () => {
                const details = document.getElementById(`details-${index}`);
                details.style.display = details.style.display === "none" ? "block" : "none";
            });

            const detailsDiv = document.createElement("div");
            detailsDiv.id = `details-${index}`;
            detailsDiv.style.display = "none";
            detailsDiv.innerHTML = `
                <p><strong>Оригінал:</strong> ${row.article_text}</p>
                <button id="translate-btn-${index}">Translate to English</button>
                <div id="translated-${index}" style="margin-top: 5px; color: green;"></div>
            `;

            li.appendChild(titleEl);
            li.appendChild(detailsDiv);
            resultsList.appendChild(li);

            setTimeout(() => {
                document.getElementById(`translate-btn-${index}`).addEventListener("click", () => {
                    translate(index);
                });
            }, 0);
        });
    }

    function translate(index) {
        const row = rawResults[index];
        fetch("/translate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title: row.title, text: row.article_text })
        })
        .then(response => response.json())
        .then(data => {
            console.log("Translation result:", data);
            document.getElementById(`translated-${index}`).innerHTML = `
                <strong>Translated Title:</strong> ${data.translated_title}<br>
                <strong>Translated Text:</strong> ${data.translated_text}
            `;
        })
        .catch(error => console.error("Translation error:", error));
    }
</script>
</body>
</html>